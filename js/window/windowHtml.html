<html>
	<head>
		<link rel="stylesheet" href="../../gui/icons.css" type="text/css" />
		<style>
			html,body{
				width: 100%;
				height: 100%;
				margin: 0;
				overflow: hidden;
			}
		</style>
		
		<script type="text/javascript" src="../scriptLoader/$ScriptLoader.js"></script>
		<script type="text/javascript" src="Window.js"></script>
		
		<!-- window initialisation code-->
		<script>
			(function(){
				var initialised = false;
		    	var ipc = require('electron').ipcRenderer;
				ipc.on("windowInit", function(event, data){
					var script = data.script;
					var loadScriptsScript = data.loadScriptsScript;
					window.parentID = data.windowID;
					if(!initialised){
						//create window variables map
						var windowKeys = Object.keys(window);
						
						//execute the loadScript
						if(loadScriptsScript){
							$ScriptLoader.runCode(loadScriptsScript);	
						}
						
						//execute the code
						$ScriptLoader.runCode(script);
						
						//get windowClass
						var windowClass;
						if(window.WindowClass){
							//window class was saved in window because the class object was passed directly
							windowClass = window.WindowClass;
						}else{
							//find the window class
							var newWindowKeys = Object.keys(window);
							for(var i=0; i<newWindowKeys.length; i++){
								var key = newWindowKeys[i];
								if(windowKeys.indexOf(key)==-1){
									var val = window[key];
									if(val && val.prototype instanceof Window){
										windowClass = val;
										break;
									}
								}
							}						
						}
						
						
						//instantiate the window class
						if(windowClass){
							window.$Window = new windowClass();
						}else{
							console.error("No custom Window object could be found, using the default one");
							window.$Window = new Window();
						}
						delete window.Window;
						
						initialised = true;
					}
				});
			})();
		</script>
	</head>
	<body>
		
	</body>
</html>